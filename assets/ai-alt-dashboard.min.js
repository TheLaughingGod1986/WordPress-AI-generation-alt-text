!function(t){const e=window.AI_ALT_GPT_DASH||{},a={generate:e.rest||window.AI_ALT_GPT&&AI_ALT_GPT.rest||"",stats:e.restStats||window.AI_ALT_GPT&&AI_ALT_GPT.restStats||"",missing:e.restMissing||window.AI_ALT_GPT&&AI_ALT_GPT.restMissing||"",all:e.restAll||window.AI_ALT_GPT&&AI_ALT_GPT.restAll||""},n=e.nonce||window.AI_ALT_GPT&&AI_ALT_GPT.nonce||"",s=t(".ai-alt-dashboard--primary"),i=t(".ai-alt-dashboard--usage");if(!s.length&&!i.length)return;const r="#1d2327",o="#50575e",l={bar:s.find(".ai-alt-progress__bar span"),progressWrap:s.find(".ai-alt-progress__bar"),coverageHint:s.find("[data-coverage-hint]"),coverageValue:s.find("#ai-alt-coverage-value"),coverageSummary:s.find("#ai-alt-coverage-summary"),coverageViz:s.find("[data-coverage-viz]"),coverageBadge:s.find("[data-coverage-badge]"),coverageLegend:s.find("[data-coverage-legend]"),auditBody:s.find(".ai-alt-audit-rows"),progressLog:s.find("[data-progress-log]"),stats:{total:s.find('[data-stat="total"]'),withAlt:s.find('[data-stat="with-alt"]'),missing:s.find('[data-stat="missing"]'),generated:s.find('[data-stat="generated"]'),tokens:s.find('[data-stat="tokens"]')},recentContainer:s.find("[data-recent-list]"),statusBar:s.find("[data-progress-status]"),buttons:{missing:s.find('[data-action="generate-missing"]'),all:s.find('[data-action="regenerate-all"]')},usage:{requests:i.find(".ai-alt-usage__value--requests"),prompt:i.find(".ai-alt-usage__value--prompt"),completion:i.find(".ai-alt-usage__value--completion"),last:i.find(".ai-alt-usage__value--last")},auditPagination:i.find("[data-audit-pagination]")},c=s.length?document.getElementById("ai-alt-coverage"):null,d=c?c.getContext("2d"):null;function u(t){const e=-1!==(t.headers&&t.headers.get&&t.headers.get("content-type")||"").indexOf("application/json");return(e?t.json():t.text()).then(function(a){if(!t.ok){let n=a;if(!e)if("string"==typeof a&&a.trim().length)try{n=JSON.parse(a)}catch(t){n={message:a}}else n={message:a};throw"string"==typeof n&&(n={message:n}),n&&"object"==typeof n&&(n.status||(n.status=t.status),n.statusText||(n.statusText=t.statusText)),n}if(!e&&"string"==typeof a)try{return JSON.parse(a)}catch(t){return a}return a}).catch(function(e){if(!t.ok)throw"string"==typeof e?e={message:e,status:t.status}:e&&"object"==typeof e&&!e.status&&(e.status=t.status),e;throw e})}function g(t){const a=t&&(t.message||t.data&&t.data.message)||e.l10n&&e.l10n.error||"Failed to generate ALT.";return t&&t.status?a+" (HTTP "+t.status+")":a}function p(t){return(Number(t)||0).toLocaleString()}function m(t){return null==t?"":String(t).replace(/[&<>"']/g,function(t){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]||t})}function h(t){const e=Number(t||0);return Math.max(0,Math.min(100,e))}function f(t,e){if(!l.statusBar.length)return;const a="string"==typeof t&&t.length?t:"";l.statusBar.text(a),l.statusBar.toggleClass("is-active",!!e&&!!a)}function _(){return(new Date).toLocaleTimeString([],{hour:"numeric",minute:"2-digit",second:"2-digit"})}function b(e,a){if(!l.progressLog.length||!e)return;const n=t('<div class="ai-alt-progress-log__item"/>').attr("data-type",a||"info").text(e);l.progressLog.prepend(n);const s=l.progressLog.find(".ai-alt-progress-log__item");s.length>12&&s.slice(12).remove()}function v(t,a){if(!t||!t.length)return;const n=t.data("label-original")||t.text();if(t.data("label-original")||t.data("label-original",n),a){const a=e.l10n&&e.l10n.loadingButton||"Processingâ€¦";t.text(a).addClass("is-loading").prop("disabled",!0)}else{const e=t.data("label-original");e&&t.text(e),t.removeClass("is-loading").prop("disabled",!1)}}function P(a){if(!a)return;!function(t){if(!l.stats)return;l.stats.total&&l.stats.total.length&&l.stats.total.text(p(t.total||0)),l.stats.withAlt&&l.stats.withAlt.length&&l.stats.withAlt.text(p(t.with_alt||0)),l.stats.missing&&l.stats.missing.length&&l.stats.missing.text(p(t.missing||0)),l.stats.generated&&l.stats.generated.length&&l.stats.generated.text(p(t.generated||0));const e=t.usage&&t.usage.total||t.total_tokens;l.stats.tokens&&l.stats.tokens.length&&l.stats.tokens.text(p(e||0))}(a),function(t){if(!s.length)return;const a=h(t.coverage),n=a.toFixed(1).replace(/\.0$/,"")+"%",i=(e.l10n&&e.l10n.coverageValue?e.l10n.coverageValue:"ALT coverage at %s").replace("%s",n);if(l.coverageHint.length){const t=e.l10n&&e.l10n.coverageSuffix?e.l10n.coverageSuffix:"coverage";l.coverageHint.text(n+" "+t)}if(l.coverageValue.length)l.coverageValue.text(n);else{const t=s.find(".ai-alt-dashboard__coverage strong").first();t.length&&t.text(n)}l.coverageSummary.length&&l.coverageSummary.attr("data-coverage",n),l.bar.length&&l.bar.css("width",a+"%"),l.progressWrap&&l.progressWrap.length&&l.progressWrap.attr({"aria-valuenow":a.toFixed(1),"aria-valuetext":i})}(a);const n={with_alt:Number(a.with_alt||0),missing:Number(a.missing||0),coverage:Number(a.coverage||0)};!function(t){if(!d||!c)return;const e=Math.max(0,(t.with_alt||0)+(t.missing||0)),a=e?(t.with_alt||0)/e:0,n=1-a,s=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--ai-alt-chart-size"))||220;c.width===s&&c.height===s||(c.width=s,c.height=s),d.clearRect(0,0,c.width,c.height);const i=c.width/2,l=c.height/2,u=Math.min(i,l)-18;d.lineCap="round";const g=d.createLinearGradient(0,0,c.width,c.height);function p(t,e){const a=d.createLinearGradient(0,0,c.width,c.height);return a.addColorStop(0,t),a.addColorStop(1,e),a}function m(t,e,a){e<=0||(d.beginPath(),d.strokeStyle=a,d.lineWidth=22,d.shadowColor="rgba(37, 99, 235, 0.3)",d.shadowBlur=8,d.arc(i,l,u,t,t+e*Math.PI*2,!1),d.stroke(),d.shadowBlur=0)}g.addColorStop(0,"rgba(226, 232, 240, 0.6)"),g.addColorStop(1,"rgba(203, 213, 225, 0.35)"),d.beginPath(),d.lineWidth=22,d.strokeStyle=g,d.shadowColor="rgba(15, 23, 42, 0.12)",d.shadowBlur=12,d.arc(i,l,u,0,2*Math.PI),d.stroke(),d.shadowBlur=0;const f=p("#2563eb","#1d4ed8"),_=p("#f97316","#ef4444");m(-Math.PI/2,a,f),m(-Math.PI/2+a*Math.PI*2,n,_),d.beginPath(),d.fillStyle="rgba(255, 255, 255, 0.94)",d.shadowColor="rgba(15, 23, 42, 0.08)",d.shadowBlur=10,d.arc(i,l,u-22+10,0,2*Math.PI),d.fill(),d.shadowBlur=0;const b=h(t.coverage).toFixed(1).replace(/\.0$/,"")+"%";d.font='600 28px "Inter", "Segoe UI", sans-serif',d.fillStyle=r,d.textAlign="center",d.textBaseline="middle",d.fillText(b,i,l-6),d.font='13px "Inter", "Segoe UI", sans-serif',d.fillStyle=o,d.fillText("coverage",i,l+18)}(n);const u=n.missing<=0;if(l.coverageBadge.length&&l.coverageBadge.prop("hidden",!u),l.coverageLegend.length&&l.coverageLegend.prop("hidden",u),l.coverageViz.length&&l.coverageViz.attr("data-coverage-complete",u?"1":"0"),function(t){if(i.length&&(l.usage.requests.length&&l.usage.requests.text(p(t.requests||0)),l.usage.prompt.length&&l.usage.prompt.text(p(t.prompt||0)),l.usage.completion.length&&l.usage.completion.text(p(t.completion||0)),l.usage.last.length)){const a=e.l10n&&e.l10n.noRequests?e.l10n.noRequests:"None yet",n=t.last_request_formatted||t.last_request||a;l.usage.last.text(n)}}(a.usage||{}),e.auditPage=Number(a.audit_page||e.auditPage||1),e.auditPages=Number(a.audit_pages||e.auditPages||1),e.auditPerPage=Number(a.audit_per_page||e.auditPerPage||10),e.auditLinks=a.audit_links||e.auditLinks||"",e.auditBase=a.audit_base||e.auditBase||"",function(a,n){if(!l.auditBody.length)return;const s=e.l10n&&e.l10n.noAudit?e.l10n.noAudit:"No usage data recorded yet.";if(l.auditBody.empty(),a&&a.length){if(a.forEach(function(e){const a=t("<tr/>").attr("data-id",e.id),n=e.edit_url||"#",s=t("<td/>");t("<a/>",{href:n,text:e.title||"#"+e.id}).appendTo(s),a.append(s);const i=(e.source||"unknown").toLowerCase(),r=e.source_label||i.replace(/[-_]/g," ").replace(/\b\w/g,function(t){return t.toUpperCase()}),o=e.source_description||"";a.append(t("<td/>").addClass("ai-alt-audit__source").append(t("<span/>").addClass("ai-alt-badge ai-alt-badge--"+i).attr("title",o).text(r))),a.append(t("<td/>").addClass("ai-alt-audit__tokens").text(p(e.tokens||0))),a.append(t("<td/>").text(p(e.prompt||0))),a.append(t("<td/>").text(p(e.completion||0))),a.append(t("<td/>").text(e.generated||"")),l.auditBody.append(a)}),l.auditPagination.length){const t=n&&n.audit_links?n.audit_links:e.auditLinks||"";l.auditPagination.html(t)}}else if(l.auditBody.append('<tr class="ai-alt-audit__empty"><td colspan="6">'+s+"</td></tr>"),l.auditPagination.length){const t=n&&n.audit_links?n.audit_links:e.auditLinks||"";l.auditPagination.html(t)}}(a.audit||[],a),e.recentPage=Number(a.recent_page||e.recentPage||1),e.recentPages=Number(a.recent_pages||e.recentPages||1),e.recentPerPage=Number(a.recent_per_page||e.recentPerPage||5),e.recentLinks=a.recent_links||e.recentLinks||"",e.recentBase=a.recent_base||e.recentBase||"",function(t,a){if(!l.recentContainer.length)return;const n=l.recentContainer,s=n.find(".ai-alt-recent__list"),i=n.find(".ai-alt-recent__empty"),r=n.find("[data-recent-pagination]"),o=a&&a.recent_page?Number(a.recent_page):e.recentPage||1,c=a&&a.recent_pages?Number(a.recent_pages):e.recentPages||1;if(!t||!t.length){if(s.length&&s.remove(),i.length?i.show():n.append('<p class="ai-alt-recent__empty">'+(e.l10n&&e.l10n.noRecent?e.l10n.noRecent:"Generate ALT text for an image to see recent results here.")+"</p>"),r.length){const t=a&&a.recent_links?a.recent_links:"";r.html(t)}return void n.attr("data-recent-page",o).attr("data-recent-pages",c)}n.find(".ai-alt-recent__empty").remove(),s.length||n.append('<ul class="ai-alt-recent__list"></ul>');const d=n.find(".ai-alt-recent__list");if(d.empty(),t.forEach(function(t){const a=t.thumb?'<img src="'+m(t.thumb)+'" alt="" loading="lazy">':'<span aria-hidden="true">ðŸ“·</span>',n=m(t.source||"unknown"),s=m(t.source_label||t.source||"unknown"),i='<span class="ai-alt-badge ai-alt-badge--'+n+'" title="'+m(t.source_description||"")+'">'+s+"</span>",r=['<li class="ai-alt-recent__item" data-id="'+m(t.id)+'">','<div class="ai-alt-recent__thumb">'+a+"</div>",'<div class="ai-alt-recent__body">','<p class="ai-alt-recent__title"><a href="'+m(t.edit_url||"#")+'">'+m(t.title||"#"+t.id)+"</a></p>",'<div class="ai-alt-recent__meta">',"<span>"+m(t.generated||"")+"</span> Â· "+i,"</div>",'<p class="ai-alt-recent__alt">'+m(t.alt||"")+"</p>",'<div class="ai-alt-recent__actions">','<button type="button" class="button button-small ai-alt-button ai-alt-button--ghost ai-alt-regenerate-single" data-id="'+m(t.id)+'">'+(e.l10n&&e.l10n.regenerate?e.l10n.regenerate:"Regenerate")+"</button>","</div>","</div>","</li>"].join("");d.append(r)}),n.attr("data-recent-page",o).attr("data-recent-pages",c),r.length){const t=a&&a.recent_links?a.recent_links:e.recentLinks||"";r.html(t)}}(a.recent||[],a),l.buttons.missing.length){const t=!(a.missing>0);l.buttons.missing.prop("disabled",t),l.buttons.missing.toggleClass("is-disabled",t)}e.stats=a}function w(){if(!a.stats)return;const t=new URL(a.stats,window.location.origin);e.recentPage&&t.searchParams.set("recent_page",e.recentPage),e.recentPerPage&&t.searchParams.set("recent_per_page",e.recentPerPage),e.auditPage&&t.searchParams.set("audit_page",e.auditPage),e.auditPerPage&&t.searchParams.set("audit_per_page",e.auditPerPage);const s={Accept:"application/json"};n&&(s["X-WP-Nonce"]=n),fetch(t.toString(),{credentials:"same-origin",headers:s}).then(u).then(function(t){t&&(P(t),f(e.l10n&&e.l10n.statusReady||""))}).catch(function(t){if(t&&"duplicate_alt"===t.code)return Promise.resolve();console.error("AI ALT stats fetch failed",t);const e=g(t);f(e,!1),window.aiAltToast&&window.aiAltToast.error("Stats Update Failed",e)})}function A(t){if(!t||!t.length){const t=_(),a=e.l10n&&e.l10n.batchCompleteAt?e.l10n.batchCompleteAt.replace("%s",t):"Batch complete at "+t;return f(a,!1),b(a,"success"),window.aiAltToast&&window.aiAltToast.success("Batch Complete","All ALT text generation tasks finished successfully."),w(),Promise.resolve()}const s=t.shift(),i=e.l10n&&e.l10n.processingMissing?e.l10n.processingMissing.replace("%d",s):"Generating ALT for #"+s+"â€¦";if(f(i,!0),b(i+" Â· "+_(),"info"),!a.generate)return f(e.l10n&&e.l10n.restUnavailable||"REST endpoint unavailable",!1),Promise.reject(!1);const r={Accept:"application/json"};return n&&(r["X-WP-Nonce"]=n),fetch(a.generate+s,{method:"POST",credentials:"same-origin",headers:r}).then(u).then(function(){return b((e.l10n&&e.l10n.completedItem?e.l10n.completedItem.replace("%d",s):"Finished #"+s)+" Â· "+_(),"success"),A(t)}).catch(function(a){if(a&&"duplicate_alt"===a.code){return A(t.slice())}console.error("AI ALT batch generation error",a);const n=g(a);f(n,!1);b((e.l10n&&e.l10n.failedItem?e.l10n.failedItem.replace("%d",s):"Failed #"+s)+" Â· "+_()+" â€” "+n,"error"),window.aiAltToast&&window.aiAltToast.error("Generation Failed","Failed to generate ALT for attachment #"+s+". "+n),w()})}function y(t,s){if(!a.generate)return f(e.l10n&&e.l10n.restUnavailable||"REST endpoint unavailable",!1),void(s&&v(s,!1));(function(t){const s="all"===t?a.all:a.missing;if(!s)return f(e.l10n&&e.l10n.restUnavailable||"REST endpoint unavailable",!1),Promise.reject();f(e.l10n&&e.l10n.prepareBatch||"Preparing image listâ€¦",!0);const i={Accept:"application/json"};return n&&(i["X-WP-Nonce"]=n),fetch(s,{credentials:"same-origin",headers:i}).then(u).then(function(t){return t})})(t).then(function(t){const a=Array.isArray(t.ids)?t.ids.slice():[];if(!a.length){f(e.l10n&&e.l10n.nothingToProcess||"No images to process.",!1);return b((e.l10n&&e.l10n.nothingToProcess||"No images to process.")+" Â· "+_(),"info"),w(),Promise.resolve()}return l.progressLog.length&&l.progressLog.empty(),b((e.l10n&&e.l10n.batchStart||"Starting batchâ€¦")+" ("+a.length+") Â· "+_(),"info"),A(a)}).catch(function(t){if(!t)return;if(!1===t)return;if(t&&"duplicate_alt"===t.code)return;console.error("AI ALT request list failed",t);const e=g(t);f(e,!1),b(e+" Â· "+_(),"error")}).finally(function(){s&&v(s,!1)})}P(e.stats||{}),e.recentPerPage=e.recentPerPage||e.stats&&e.stats.recent_per_page||5,e.recentPage=e.recentPage||e.stats&&e.stats.recent_page||1,e.recentPages=e.recentPages||e.stats&&e.stats.recent_pages||1,e.recentLinks=e.recentLinks||e.stats&&e.stats.recent_links||"",e.auditPerPage=e.auditPerPage||e.stats&&e.stats.audit_per_page||10,e.auditPage=e.auditPage||e.stats&&e.stats.audit_page||1,e.auditPages=e.auditPages||e.stats&&e.stats.audit_pages||1,e.auditLinks=e.auditLinks||e.stats&&e.stats.audit_links||"",f("",!1),window.addEventListener("ai-alt-stats-update",function(t){const e=t.detail||{};P(e.stats||e),f("",!1)}),l.buttons.missing.length&&l.buttons.missing.on("click",function(e){if(e.preventDefault(),t(this).prop("disabled"))return;const a=t(this);v(a,!0),y("missing",a)}),l.buttons.all.length&&l.buttons.all.on("click",function(a){a.preventDefault();const n=e.l10n&&e.l10n.confirmRegenerateAll||"Regenerate ALT for all images?";if(!window.confirm(n))return;const s=t(this);v(s,!0),y("all",s)}),window.aiAltToast=function(){let t=null,e=0;function a(){return t||(t=document.createElement("div"),t.className="ai-alt-toast-container",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","false"),document.body.appendChild(t)),t}function n(t){const n=++e,i=t.type||"info",r=t.title||"",o=t.message||"",l=void 0!==t.duration?t.duration:5e3,c=!1!==t.closeable,d=document.createElement("div");d.className="ai-alt-toast ai-alt-toast--"+i,d.setAttribute("role","status"),d.setAttribute("data-toast-id",n);const u=document.createElement("div");u.className="ai-alt-toast__icon",u.textContent=function(t){const e={success:"âœ“",error:"âœ•",warning:"âš ",info:"â„¹"};return e[t]||e.info}(i),u.setAttribute("aria-hidden","true");const g=document.createElement("div");if(g.className="ai-alt-toast__content",r){const t=document.createElement("div");t.className="ai-alt-toast__title",t.textContent=r,g.appendChild(t)}if(o){const t=document.createElement("p");t.className="ai-alt-toast__message",t.textContent=o,g.appendChild(t)}if(d.appendChild(u),d.appendChild(g),c){const t=document.createElement("button");t.className="ai-alt-toast__close",t.setAttribute("type","button"),t.setAttribute("aria-label","Close notification"),t.textContent="Ã—",t.addEventListener("click",function(){s(n)}),d.appendChild(t)}if(l>0){const t=document.createElement("div");t.className="ai-alt-toast__progress";const e=document.createElement("div");e.className="ai-alt-toast__progress-bar",e.style.width="100%",e.style.transitionDuration=l+"ms",t.appendChild(e),d.appendChild(t),requestAnimationFrame(function(){requestAnimationFrame(function(){e.style.width="0%"})}),setTimeout(function(){s(n)},l)}return a().appendChild(d),n}function s(e){const a=t?t.querySelector('[data-toast-id="'+e+'"]'):null;a&&(a.classList.add("is-leaving"),setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a),t&&0===t.children.length&&(t.parentNode.removeChild(t),t=null)},200))}return{show:n,success:function(t,e,a){return n({type:"success",title:t,message:e,duration:a})},error:function(t,e,a){return n({type:"error",title:t,message:e,duration:a||7e3})},warning:function(t,e,a){return n({type:"warning",title:t,message:e,duration:a})},info:function(t,e,a){return n({type:"info",title:t,message:e,duration:a})},errorWithRetry:function(t,n,i){const r=++e,o=document.createElement("div");o.className="ai-alt-toast ai-alt-toast--error",o.setAttribute("role","alert"),o.setAttribute("data-toast-id",r);const l=document.createElement("div");l.className="ai-alt-toast__icon",l.textContent="âœ•",l.setAttribute("aria-hidden","true");const c=document.createElement("div");c.className="ai-alt-toast__content";const d=document.createElement("div");if(d.className="ai-alt-toast__title",d.textContent=t,c.appendChild(d),n){const t=document.createElement("p");t.className="ai-alt-toast__message",t.textContent=n,c.appendChild(t)}const u=document.createElement("button");u.className="ai-alt-button ai-alt-button--outline",u.textContent="Retry",u.style.marginTop="8px",u.style.fontSize="12px",u.style.padding="6px 14px",u.addEventListener("click",function(){s(r),"function"==typeof i&&i()}),c.appendChild(u),o.appendChild(l),o.appendChild(c);const g=document.createElement("button");return g.className="ai-alt-toast__close",g.setAttribute("type","button"),g.setAttribute("aria-label","Close notification"),g.textContent="Ã—",g.addEventListener("click",function(){s(r)}),o.appendChild(g),a().appendChild(o),r},remove:s}}()}(jQuery);