!function(t){function e(t){var e=Number(t);if(!isFinite(e))return t;if("undefined"!=typeof Intl&&Intl.NumberFormat)try{return(new Intl.NumberFormat).format(e)}catch(t){}return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function a(e,a){if(window.wp&&wp.data&&wp.data.dispatch)try{return void wp.data.dispatch("core/notices").createNotice(e,a,{isDismissible:!0})}catch(t){}var i=function(e,a){return t('<div class="notice notice-'+e+' is-dismissible"><p>'+a+"</p></div>")}(e,a),n=t("#wpbody-content").find(".wrap").first();n.length?n.prepend(i):t("#wpbody-content").prepend(i)}function i(){window.AI_ALT_GPT&&AI_ALT_GPT.restStats&&window.fetch&&fetch(AI_ALT_GPT.restStats,{credentials:"same-origin",headers:{"X-WP-Nonce":AI_ALT_GPT.nonce,Accept:"application/json"}}).then(function(t){return t.ok?t.json():null}).then(function(t){if(t&&"function"==typeof window.dispatchEvent)try{window.dispatchEvent(new CustomEvent("ai-alt-stats-update",{detail:t}))}catch(t){}}).catch(function(){})}function n(){var a=t("[data-library-summary]");if(a.length){var i={total:0,sum:0,healthy:0,review:0,critical:0};if(t(".ai-alt-library__score").each(function(){var e=t(this),a=e.attr("data-score"),n=Number(void 0!==a?a:e.data("score"));if(isFinite(n)){i.total+=1,i.sum+=n;var r=(e.attr("data-status")||e.data("status")||"").toString();"great"===r||"good"===r?i.healthy+=1:"review"===r?i.review+=1:i.critical+=1}}),i.total){var n=Math.round(i.sum/i.total);a.find("[data-library-summary-average]").text(e(n)),a.find("[data-library-summary-healthy]").text(e(i.healthy)),a.find("[data-library-summary-review]").text(e(i.review)),a.find("[data-library-summary-critical]").text(e(i.critical)),a.find("[data-library-summary-total]").text(e(i.total))}}}function r(o,l){var s=window.AI_ALT_GPT&&AI_ALT_GPT.rest?{rest:AI_ALT_GPT.rest,nonce:AI_ALT_GPT.nonce||(window.wpApiSettings?wpApiSettings.nonce:"")}:window.AI_ALT_GPT_DASH&&AI_ALT_GPT_DASH.rest?{rest:AI_ALT_GPT_DASH.rest,nonce:AI_ALT_GPT_DASH.nonce||(window.wpApiSettings?wpApiSettings.nonce:"")}:window.wpApiSettings&&wpApiSettings.root?{rest:wpApiSettings.root+"ai-alt/v1/generate/",nonce:wpApiSettings.nonce}:null;s&&s.rest?(l.text("Generating…"),l.is("button, input")&&l.prop("disabled",!0),t.ajax({url:s.rest+o,method:"POST",beforeSend:function(t){s.nonce&&t.setRequestHeader("X-WP-Nonce",s.nonce)}}).done(function(s){if(s&&"duplicate_alt"===s.code)r(o,l);else if(s&&s.alt)!function(e,a,i){var n=window.AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.previewAltHeading||"Review generated ALT text",r=window.AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.previewAltHint||"Review the generated description before applying it to your media item.",o=window.AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.previewAltApply||"Use this ALT",l=window.AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.previewAltCancel||"Keep current ALT",s=window.AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.previewAltDismissed||"Preview dismissed. Existing ALT kept.",d=t('<div class="ai-alt-preview-overlay" role="dialog" aria-modal="true"></div>'),c=t('<div class="ai-alt-preview"></div>').appendTo(d);t("<h3/>").text(n).appendTo(c),t("<p/>").text(r).appendTo(c),t('<div class="ai-alt-preview__text" aria-live="polite"></div>').text(e).appendTo(c);var u=t('<div class="ai-alt-preview__meta"></div>').appendTo(c);t("<span/>").text(e.length+" characters").appendTo(u);var p=t('<div class="ai-alt-preview__actions"></div>').appendTo(c),g=t('<button type="button" class="button ai-alt-preview__cancel"></button>').text(l).appendTo(p),f=t('<button type="button" class="button ai-alt-preview__apply"></button>').text(o).appendTo(p);function _(){t(document).off("keydown.aiAltPreview"),d.remove()}g.on("click",function(){_(),"function"==typeof i&&i(s)}),f.on("click",function(){_(),"function"==typeof a&&a(e)}),t(document).on("keydown.aiAltPreview",function(t){"Escape"===t.key&&(t.preventDefault(),_(),"function"==typeof i&&i(s))}),d.on("click",function(t){t.target===d.get(0)&&(_(),"function"==typeof i&&i(s))}),t("body").append(d)}(s.alt,function(r){var d=l.closest(".compat-item, .attachment-details, .media-modal");!function(e,a,i){var n;if(["#attachment_alt","#attachments-"+e+"-alt",'[data-setting="alt"] textarea','[data-setting="alt"] input','[name="attachments['+e+'][alt]"]','[name="attachments['+e+'][_wp_attachment_image_alt]"]','[name="attachments['+e+'][image_alt]"]'].some(function(e){var a=i&&i.length?i.find(e):t();return a.length||(a=t(e)),!!a.length&&(n=a.first(),!0)}),n&&n.length&&(n.val(a),n.text(a),n.attr("value",a),n.trigger("input").trigger("change").trigger("keyup")),window.wp&&wp.media&&"function"==typeof wp.media.attachment&&e){var r=wp.media.attachment(e);if(r)try{r.set("alt",a),"function"==typeof r.save&&r.save()}catch(t){}}if(window.wp&&wp.data&&wp.data.dispatch)try{wp.data.dispatch("core").editEntityRecord("postType","attachment",e,{alt_text:a})}catch(t){}}(o,r,d.length?d:null),window.aiAltToast?window.aiAltToast.success("ALT Text Generated",r,6e3):a("success","ALT generated: "+r+" - "+(AI_ALT_GPT&&AI_ALT_GPT.l10n&&AI_ALT_GPT.l10n.reviewCue?AI_ALT_GPT.l10n.reviewCue:"Review it in the ALT Library to confirm it matches the image.")),i();var c=d.length>0;if(l.attr("data-has-alt","1"),l.is("a"))l.text(l.data("label-regenerate")||"Regenerate Alt Text (AI)");else{var u=l.data("label-regenerate")||"Regenerate Alt";l.data("original-text",u),l.text(u)}var p=l.closest(".ai-alt-library__row");if(p.length){c=!0,p.removeClass("ai-alt-library__row--missing");var g=p.find(".ai-alt-library__alt");if(g.length&&g.empty().text(r),p.find(".ai-alt-library__flag").remove(),s.meta){if(void 0!==s.meta.tokens){var f=p.find(".ai-alt-library__tokens");f.length&&f.text(e(s.meta.tokens))}if(void 0!==s.meta.generated){var _=p.find(".ai-alt-library__generated");_.length&&_.text(s.meta.generated||"")}if(void 0!==s.meta.score){var m=p.find(".ai-alt-library__score");if(m.length){var v=s.meta.score_status||"";m.attr("data-score",s.meta.score).attr("data-status",v);var w=m.find(".ai-alt-score-badge");w.length&&w.text(e(s.meta.score)).attr("class","ai-alt-score-badge ai-alt-score-badge--"+v);var A=m.find(".ai-alt-score-label");A.length&&A.text(s.meta.score_grade||"");var T=m.find(".ai-alt-score-issues");s.meta.score_issues&&s.meta.score_issues.length?(T.length?T.empty():T=t('<ul class="ai-alt-score-issues"></ul>').appendTo(m),s.meta.score_issues.forEach(function(e){t("<li/>").text(e).appendTo(T)})):T.length&&T.remove()}}}n()}var h=l.closest(".ai-alt-recent__item");h.length&&(c=!0,h.find(".ai-alt-recent__alt").text(r)),c||location.reload()},function(t){t&&a("info",t)});else if(s&&"ai_alt_dry_run"===s.code)window.aiAltToast?window.aiAltToast.info("Dry Run Mode",s.message||"Prompt stored for review."):a("info",s.message||"Dry run enabled. Prompt stored for review."),i();else{var d=s&&(s.message||s.data&&s.data.message)||"Failed to generate ALT";window.aiAltToast?window.aiAltToast.error("Generation Failed",d):a("error",d)}}).fail(function(t){var e=t.responseJSON||{};if(e&&"duplicate_alt"===e.code)r(o,l);else{var i=e.message||e.data&&e.data.message||"Error communicating";window.aiAltToast?window.aiAltToast.error("Request Failed",i):a("error",i)}}).always(function(){!function(t){var e,a=t.data("original-text");e=t.is("a")?t.data("label-regenerate")||t.data("label-generate")||t.text()||"Regenerate Alt Text (AI)":void 0!==a?a:t.data("label-generate")||"Generate Alt",t.text(e),t.is("button, input")&&t.prop("disabled",!1)}(l)})):a("error","AI ALT: REST URL missing.")}function o(e){var a=t(".ai-alt-library__table tbody tr"),i=t("[data-library-summary] [data-summary-filter]");if(!e||"clear"===e)return a.show(),i.removeClass("is-active"),void t('[data-summary-filter="clear"]').addClass("is-active");a.each(function(){var a=t(this),i=(a.find(".ai-alt-library__score").attr("data-status")||"").toString();i?"healthy"===e?a.toggle("great"===i||"good"===i):a.toggle(i===e):a.toggle("healthy"===e)}),i.removeClass("is-active"),t('[data-summary-filter="'+e+'"]').addClass("is-active")}function l(){var e=t(".ai-alt-language-select");e.length&&e.each(function(){var e=t(this),a=e.closest("td").find(".ai-alt-language-custom"),i=e.val();if(a.length){var n="custom"===i;a.toggleClass("is-visible",n),n?a.show():a.hide()}})}t(document).on("click",".ai-alt-generate",function(e){e.preventDefault();var i=t(this),n=i.data("id");n?(void 0===i.data("original-text")&&i.data("original-text",i.text()),i.data("has-alt")&&(i.is("a")?i.text(i.data("label-regenerate")||i.text()):i.text(i.data("label-regenerate")||i.data("original-text")||"Regenerate Alt")),r(n,i)):a("error","AI ALT: Attachment ID missing.")}),t(document).on("click",".ai-alt-regenerate-single",function(){var e=t(this),a=e.data("id");a&&(void 0===e.data("original-text")&&e.data("original-text",e.text()),r(a,e.text("Regenerating…").prop("disabled",!0)))}),t(document).on("click keypress","[data-summary-filter]",function(e){"keypress"===e.type&&13!==e.which&&32!==e.which||(e.preventDefault(),o(t(this).data("summary-filter")))}),t(document).on("change",".ai-alt-language-select",l),t(document).ready(function(){l(),n(),o("clear")})}(jQuery);